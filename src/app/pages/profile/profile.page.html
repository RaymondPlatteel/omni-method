<ion-header [translucent]="false" class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>Omni Score {{(user$ | async)?.omniScore}}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" #scrollarea no-bounce>
  <!-- <ion-refresher
    slot="fixed"
    pullMax="200"
    pullMin="60"
    (ionRefresh)="handleRefresh($event)"
  >
    <ion-refresher-content
      pullingIcon="none"
      refreshingSpinner="none"
    ></ion-refresher-content>
  </ion-refresher> -->
  <ion-header collapse="condense">
    <ion-toolbar color="default">
      <ion-card class="card cardStyle topCard bg-transparent">
        <ng-container *ngIf="user$ | async as user; else loading ">
          <ion-item lines="none" color="none">
            <user-avatar
              [user]="user"
              [ngStyle]="{'color': 'white'}"
            ></user-avatar>
            <span slot="end">
              <ion-button
                id="open-modal"
                style="float: right"
                color="none"
                (click)="openEditProfile($event, user)"
              >
                <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
              </ion-button>
            </span>
          </ion-item>
          <ion-item lines="none" color="none" text-center class="name">
            <ion-label> {{user.firstName}} {{user.lastName}} </ion-label>
          </ion-item>
          <ion-item lines="none" color="none">
            <ion-grid class="ion-text-center">
              <ion-row>
                <ion-col>
                  <ion-label>Age</ion-label>
                  <ion-label>{{getAge(user)}}</ion-label>
                </ion-col>
                <ion-col>
                  <ion-label>Body Weight</ion-label>
                  <ion-label>{{user.weight}}</ion-label>
                </ion-col>
                <ion-col>
                  <ion-label>Height</ion-label>
                  <ion-label
                    >{{user.height?.feet}}' {{user.height?.inches}}"</ion-label
                  >
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>

          <ion-item id="omniScore" lines="none" color="none">
            <span>
              <ion-label class="omni-label">Omni Score</ion-label>
              <ion-label class="omni-score">{{user.omniScore | number}}</ion-label>
            </span>
          </ion-item>

          <!-- <ion-item lines="none" color="none" style="--min-height: 0">
            <ion-accordion-group #accordionGroup>
              <ion-accordion value="moreProfile">
                <div slot="content" style="height: 44px">
                </div>
              </ion-accordion>
            </ion-accordion-group>
          </ion-item>
          <ion-item lines="none" color="none">
            <ion-button
              class="more-button"
              [ngClass]="moreOpen ? 'rotate-button' : ''"
              (click)="toggleAccordion($event)"
              ><ion-icon name="chevron-down"></ion-icon
            ></ion-button>
          </ion-item> -->
        </ng-container>

        <!-- Profile Loading template -->
        <ng-template #loading>
          <ion-item lines="none" color="none">
            <div id="avatar">
              <ngx-skeleton-loader
                count="1"
                appearance="circle"
                [theme]="{ height: '44px', width: '44px' }"
              ></ngx-skeleton-loader>
            </div>
            <span slot="end">
              <ion-button style="float: right" color="none">
                <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
              </ion-button>
            </span>
          </ion-item>
          <ion-item lines="none" color="none" text-center class="name">
            <ngx-skeleton-loader
              count="2"
              [theme]="{ height: '24px', width: '94px', margin: '6px' }"
            ></ngx-skeleton-loader>
          </ion-item>
          <ion-item lines="none" color="none">
            <ion-grid class="ion-text-center">
              <ion-row>
                <ion-col>
                  <ngx-skeleton-loader
                    [theme]="{ width: '30px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                  <br />
                  <ngx-skeleton-loader
                    [theme]="{ width: '20px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                </ion-col>
                <ion-col>
                  <ngx-skeleton-loader
                    [theme]="{ width: '64px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                  <br />
                  <ngx-skeleton-loader
                    [theme]="{ width: '30px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                </ion-col>
                <ion-col>
                  <ngx-skeleton-loader
                    [theme]="{ width: '64px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                  <br />
                  <ngx-skeleton-loader
                    [theme]="{ width: '60px', height: '12px', 'bottom-margin': '0px' }"
                  ></ngx-skeleton-loader>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
          <ion-item id="omniScore" lines="none" color="none">
            <div style="text-align: center">
              <ngx-skeleton-loader
                [theme]="{ width: '128px', height: '1px' }"
              ></ngx-skeleton-loader>
              <br />
              <ngx-skeleton-loader
                [theme]="{ width: '64px', height: '12px' }"
              ></ngx-skeleton-loader>
              <br />
              <ngx-skeleton-loader
                [theme]="{ width: '48px', height: '32px' }"
              ></ngx-skeleton-loader>
            </div>
          </ion-item>
        </ng-template>
      </ion-card>
    </ion-toolbar>
  </ion-header>

  <ion-card style="box-shadow: none; margin-bottom: 0">
    <ion-item lines="none">
      <ion-card-title>All Assessments</ion-card-title>
    </ion-item>

    <ng-container
      class="card cardStyle"
      *ngFor="let category of categories$ | async"
    >
      <ion-item class="cat-header" lines="none">
        {{category.label}}: {{(user$ | async)?.categoryScore[category.cid]}}
      </ion-item>
      <ng-container *ngFor="let assessment of assessments$ | async">
        <ng-container *ngIf="assessment.cid == category.cid">
          <ion-item
            (click)="openDetails(assessment)"
            style="--inner-border-width: 0"
          >
            <ion-thumbnail slot="start">
              <ion-img
                class="fit-thumbnail"
                src="{{assessment.icon}}"
              ></ion-img>
            </ion-thumbnail>
            <ion-label>{{assessment.label}}</ion-label>
            <div slot="end">
              <span class="units">{{assessment.units}}</span>
              <br />
              <span
                *ngIf="(getScores$(assessment) | async)[0] as score; else zeroScore"
              >
                <ion-badge
                  class="score"
                  ngClass="{{scoreClass(score.scoreDate)}}"
                  slot="end"
                  (click)="openNewScore($event, assessment, user)"
                  >{{score.rawScore || 0}}</ion-badge
                >
              </span>
              <ng-template #zeroScore>
                <ion-badge
                  class="score"
                  slot="end"
                  (click)="openNewScore($event, assessment, user)"
                  >0</ion-badge
                >
              </ng-template>
            </div>
          </ion-item>
        </ng-container>
      </ng-container>
    </ng-container>
  </ion-card>
  <div class="bottom-padding"></div>
</ion-content>
