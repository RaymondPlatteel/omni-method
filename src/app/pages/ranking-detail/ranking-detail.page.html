<ion-content [fullscreen]="true" #scrollarea no-bounce  class="bg-transparent">
  <div class="safe-area"></div>
  <ion-refresher slot="fixed" pullMin="999999">
    <ion-refresher-content pullingIcon="none" refreshingSpinner="none">
  </ion-refresher-content>
  </ion-refresher>

  <ion-fab vertical="top" horizontal="start" slot="fixed">
    <ion-button
      (click)="goBack()"
      type="button"
      size="default"
      shape="circle"
      color="primary"
    >
      <ion-icon name="chevron-back-outline"></ion-icon>
    </ion-button>
  </ion-fab>

  <ng-container *ngIf="{
    athlete: athlete$ | async,
    categories: categories$ | async,
    assessments: assessments$ | async,
    scores: scores$ | async,
  } as data; else loading">

    <app-profile-header [athlete$]="athlete$" [scores$]="scores$"></app-profile-header>

    <ion-card class="bg-transparent" style="box-shadow: none; margin-bottom: 0">
      <ion-item lines="none">
        <ion-card-title>All Assessments</ion-card-title>
      </ion-item>

      <ng-container *ngFor="let category of data.categories">
        <ion-item class="cat-header" lines="none">
          <ion-text>
            {{category.label}}
          </ion-text>
          <ion-text slot="end">
            Level: {{data.athlete?.categoryScore[category.cid] / 10 | number:'1.0-0'}}
          </ion-text>
        </ion-item>
        <ng-container *ngFor="let assessment of getCategoryAssessments(data.assessments, category.cid)">
          <ng-container *ngIf="getScore(data.scores, assessment.aid) as score; else zeroScore">
            <!-- assessment score card -->
            <ion-card class="assessment-summary">
              <ion-item lines="none" style="--inner-border-width: 0">
                <!-- start -->
                <ion-thumbnail slot="start">
                  <ion-img *ngIf="!showVideo" class="fit-thumbnail"
                    src="{{assessment.icon}}"></ion-img>
                  <div *ngIf="showVideo" style="height: 100%;overflow: hidden;">
                    <video *ngIf="score.videoUrl" src="{{score.videoUrl}}" style="width: 100%;"
                    ></video>
                    <ion-button *ngIf="!score.videoUrl" color="medium" class="add-video-button">
                      <!-- <ion-icon slot="icon-only" name="add-circle"></ion-icon> -->
                      <ion-icon slot="icon-only" name="videocam-off"></ion-icon>
                    </ion-button>
                  </div>
                </ion-thumbnail>
                <!-- main -->
                <ion-label>
                  <h2>{{assessment.label}}</h2>
                  <p>{{score.rawScore}} {{assessment.entryUnits}}</p>
                </ion-label>
                <!-- end -->
                <!-- <ion-label color="primary" position="fixed" slot="end">
                  <div class="score" style="text-align: right;">Lvl {{ score.calculatedScore/10 | number:'1.0-0' }}</div>
                </ion-label> -->
                <div slot="end">
                  <span class="units">Lvl {{ score.calculatedScore/10 | number:'1.0-0' }}</span>
                  <!-- <br />
                    <ion-badge
                      class="score"
                      ngClass="{{scoreClass(score.scoreDate)}}"
                      slot="end"
                      >{{score.rawScore}}</ion-badge
                    > -->
                </div>
              </ion-item>
            </ion-card>
          </ng-container>
          <ng-template #zeroScore>
            <ion-card class="assessment-summary">
              <ion-item lines="none">
                <!-- start -->
                <ion-thumbnail slot="start">
                  <ion-img class="fit-thumbnail"
                    src="{{assessment.icon}}"></ion-img>
                </ion-thumbnail>
                <!-- main -->
                <ion-label>
                  <h2>{{assessment.label}}</h2>
                </ion-label>
                  <ion-badge class="score" slot="end">0</ion-badge>
              </ion-item>
            </ion-card>
          </ng-template>

        </ng-container>
      </ng-container>

    </ion-card>
  </ng-container>
  <ng-template #loading>Loading...</ng-template>
  <div class="bottom-padding"></div>
</ion-content>
